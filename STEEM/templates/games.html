{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4">Most Popular</h2>

<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Title</th>
            <th>Genre</th>
            <th>Price</th>
            <th>Developer</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {% for game in best_rated %}
        <tr>
            <td>{{ game.Title }}</td>
            <td>{{ game.Genre }}</td>
            <td>${{ game.Price }}</td>
            <td>{{ game.DeveloperName }}</td>

            <td>
                <!-- game details/info -->
                <a href="{{ url_for('game_details', game_id=game.GameID) }}"
                   class="btn btn-sm btn-primary">
                    View Details
                </a>

                {% if session.get('role') == 'user' %}
                    {% if not game.UserHasGame %}
                        <!-- buy game -->
                        <form action="{{ url_for('buy_game', game_id=game.GameID) }}"
                              method="post"
                              style="display:inline;">
                            <button class="btn btn-sm btn-success">
                                Buy
                            </button>
                        </form>
                    {% else %}
                        <!-- to show owning -->
                        <span class="badge bg-secondary ms-2">Owned</span>
                    {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2 class="mb-4">New Releases</h2>

<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Title</th>
            <th>Genre</th>
            <th>Price</th>
            <th>Developer</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {% for game in new_releases %}
        <tr>
            <td>{{ game.Title }}</td>
            <td>{{ game.Genre }}</td>
            <td>${{ game.Price }}</td>
            <td>{{ game.DeveloperName }}</td>

            <td>
                <!-- game details/info -->
                <a href="{{ url_for('game_details', game_id=game.GameID) }}"
                   class="btn btn-sm btn-primary">
                    View Details
                </a>

                {% if session.get('role') == 'user' %}
                    {% if not game.UserHasGame %}
                        <!-- buy game -->
                        <form action="{{ url_for('buy_game', game_id=game.GameID) }}"
                              method="post"
                              style="display:inline;">
                            <button class="btn btn-sm btn-success">
                                Buy
                            </button>
                        </form>
                    {% else %}
                        <!-- to show owning -->
                        <span class="badge bg-secondary ms-2">Owned</span>
                    {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2 class="mb-4">All Games</h2>

<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Title</th>
            <th>Genre</th>
            <th>Price</th>
            <th>Developer</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {% for game in rows %}
        <tr>
            <td>{{ game.Title }}</td>
            <td>{{ game.Genre }}</td>
            <td>${{ game.Price }}</td>
            <td>{{ game.DeveloperName }}</td>

            <td>
                <!-- game details/info -->
                <a href="{{ url_for('game_details', game_id=game.GameID) }}"
                   class="btn btn-sm btn-primary">
                    View Details
                </a>

                {% if session.get('role') == 'user' %}
                    {% if not game.UserHasGame %}
                        <!-- buy game -->
                        <form action="{{ url_for('buy_game', game_id=game.GameID) }}"
                              method="post"
                              style="display:inline;">
                            <button class="btn btn-sm btn-success">
                                Buy
                            </button>
                        </form>
                    {% else %}
                        <!-- to show owning -->
                        <span class="badge bg-secondary ms-2">Owned</span>
                    {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
